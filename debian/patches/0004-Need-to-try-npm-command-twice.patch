From: Johannes Willkomm <johannes@johannes-willkomm.de>
Date: Fri, 18 Oct 2024 20:55:22 +0200
Subject: Need to try npm command twice

---
 src-js/Makefile.am | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/src-js/Makefile.am b/src-js/Makefile.am
index 8846e0b..9839657 100644
--- a/src-js/Makefile.am
+++ b/src-js/Makefile.am
@@ -55,12 +55,14 @@ node_modules = $(addprefix node_modules/, $(node_module_names))
 $(node_modules) node_modules_updated.txt:
 	touch node_modules_updated.txt
 if acond_NPM_PKGS_AVAIL
+	-true $(foreach f, $(node_module_names), && npm link $(f))
 	true $(foreach f, $(node_module_names), && npm link $(f))
 endif
 
 install-data-local:
 if acond_NPM_PKGS_AVAIL
 	install -d $(DESTDIR)$(instdir)
+	-cd $(DESTDIR)$(instdir) $(foreach f, $(node_module_names), && npm link $(f))
 	cd $(DESTDIR)$(instdir) $(foreach f, $(node_module_names), && npm link $(f))
 endif
 	$(INSTALL) -d $(apache_confd)
