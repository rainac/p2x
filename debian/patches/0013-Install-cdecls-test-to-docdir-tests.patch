From: Johannes Willkomm <johannes@johannes-willkomm.de>
Date: Mon, 23 May 2022 16:52:41 +0200
Subject: Install cdecls test to docdir/tests

---
 tests/Makefile.am    |  2 ++
 tests/run-unit-test  | 19 +++++++++++++++++++
 tests/sh/Makefile.am |  6 +++++-
 3 files changed, 26 insertions(+), 1 deletion(-)
 create mode 100644 tests/run-unit-test

diff --git a/tests/Makefile.am b/tests/Makefile.am
index bec74e0..262b1f4 100644
--- a/tests/Makefile.am
+++ b/tests/Makefile.am
@@ -1,2 +1,4 @@
 SUBDIRS = sh
 
+instdir = $(docdir)
+inst_DATA = run-unit-test
diff --git a/tests/run-unit-test b/tests/run-unit-test
new file mode 100644
index 0000000..1c0c66b
--- /dev/null
+++ b/tests/run-unit-test
@@ -0,0 +1,19 @@
+#!/bin/sh -e
+
+debname=p2x
+
+P2X_HOME=${P2X_HOME:-/usr}
+
+if [ "$AUTOPKGTEST_TMP" = "" ] ; then
+    AUTOPKGTEST_TMP=`mktemp -d /tmp/${debname}-test.XXXXXX`
+    trap "rm -rf $AUTOPKGTEST_TMP" 0 INT QUIT ABRT PIPE TERM
+fi
+cd $AUTOPKGTEST_TMP
+cp -a $P2X_HOME/share/doc/$debname/tests/* $AUTOPKGTEST_TMP
+gunzip -r *
+for testfile in *.sh; do
+    if [ -x "$testfile" ]; then
+        echo "BEGIN TEST $testfile"
+        ./$testfile
+    fi
+done
diff --git a/tests/sh/Makefile.am b/tests/sh/Makefile.am
index 740fdbf..777d1ae 100644
--- a/tests/sh/Makefile.am
+++ b/tests/sh/Makefile.am
@@ -50,7 +50,11 @@ check-good: $(good_test_results)
 
 check-bad: $(bad_test_results)
 
-install: all
+instdir = $(docdir)/tests
+bindir = $(docdir)/tests
+
+inst_DATA = setup.sh myshunit2
+dist_bin_SCRIPTS = cdecls.sh
 
 clean:
 	$(RM) -f $(generated_files) test-log.txt test-report.html log_*.txt
