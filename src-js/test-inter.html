<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
    <script type="text/javascript" src="p2x.js"></script>
    <script type="text/javascript">
      function runP2X() {
        var p2xConf = {
          scanner: document.forms.p2x.scanconf.value,
          parser: document.forms.p2x.parseconf.value,
          treeprinter: P2X.TreePrinterOptions(),
          debug: true
        }
        var res = {}
        var input = document.forms.p2x.input.value
        var output = P2X.p2xj(input, p2xConf, res)
        
        var fb = document.getElementById('scanconf_feedback')
        fb.innerHTML = '<kbd>' + res.scanner.get().toSource() + '</kbd>'
        
        var fb = document.getElementById('parseconf_feedback')
        var pcrw = P2X.ParserConfigRW()
        fb.innerHTML = '<pre>' + pcrw.asJSON(res.parser.getconfig()) + '</pre>'

        var tl = res.tokenlist
        var fb = document.getElementById('scan_feedback')
        tl.scanner = null
        fb.innerHTML = '<textarea readonly="readonly" class="xml output">' + tl.asxml() + '</textarea>'
        fb.children[0].scrollTop = fb.children[0].scrollHeight
        
        document.forms.p2x.output.value = output
     }
    </script>
    <style type="text/css">
      .output {
        font-size: 80%;
        font-weight: 300;
      }
      textarea {
        width: 100%;
        height: 20em;
      }
    </style>
    <title>Scanner test page</title>
  </head>
  <body onload="runP2X();">
    <h1>TEST</h1>

    <form name="p2x" action="javascript: runP2X()">
      <table width="100%">
        <tr>
          <td width="50%" valign="top">
            <fieldset>
              <legend>Transform input</legend>
              <textarea name="input" cols="50" rows="10" onchange="runP2X()" onkeyup="runP2X()">
minus f(x, y*2) + 456 plus 123 = 233
              </textarea>
            </fieldset>
          </td>
          <td width="50%" valign="top">
            <fieldset>
              <legend>Transform output</legend>
              <textarea name="output" cols="50" rows="10">
              </textarea>
            </fieldset>
          </td>
        </tr>
        <tr>
          <td width="50%" valign="top">
            <fieldset>
              <legend>Scanner settings</legend>
              <textarea name="scanconf" cols="50" rows="10">
{
name: 'Test',
rules: [
  { re: '\\(', action: TOKEN_L_PAREN },
  { re: '\\)', action: TOKEN_R_PAREN },
  { re: '=', action: TOKEN_EQUAL },
  { re: '\\+|plus', action: TOKEN_PLUS },
  { re: '-|minus', action: TOKEN_MINUS },
  { re: '\\*|times', action: TOKEN_MULT },
  { re: '/|div', action: TOKEN_DIV },
  { re: '%|mod', action: TOKEN_MOD },
  { re: '\\^|pow', action: TOKEN_POW },
  { re: ',', action: TOKEN_COMMA },
  { re: '[0-9]+', action: TOKEN_INTEGER },
  { re: '[a-zA-Z_][a-zA-Z0-9_]*', action: TOKEN_IDENTIFIER },
]
}
              </textarea>
              <div id="scanconf_feedback" class="feedback">
              </div>
            </fieldset>
          </td>
          <td width="50%" valign="top">
            <fieldset>
              <legend>Parser settings</legend>
              <textarea name="parseconf" cols="50" rows="10">
{
 rules: [                
  { type: TOKEN_L_PAREN, mode: MODE_POSTFIX, prec: 2000, isParen: 1,
    closingList: [
     { type: TOKEN_R_PAREN }
    ]
  },
  { type: TOKEN_EQUAL, mode: MODE_BINARY, assoc: ASSOC_RIGHT, prec: 500 },
  { type: TOKEN_COMMA, mode: MODE_BINARY, assoc: ASSOC_LEFT, prec: 800 },
  { type: TOKEN_PLUS, mode: MODE_UNARY_BINARY, assoc: ASSOC_LEFT, prec: 1000, precU: 2200 },
  { type: TOKEN_MINUS, mode: MODE_UNARY_BINARY, assoc: ASSOC_LEFT, prec: 1000, precU: 2200 },
  { type: TOKEN_MULT, mode: MODE_BINARY, assoc: ASSOC_LEFT, prec: 1100 },
  { type: TOKEN_DIV, mode: MODE_BINARY, assoc: ASSOC_LEFT, prec: 1200 },
  { type: TOKEN_MOD, mode: MODE_BINARY, assoc: ASSOC_LEFT, prec: 1300 },
  { type: TOKEN_POW, mode: MODE_BINARY, assoc: ASSOC_LEFT, prec: 1400 },
 ]
}
              </textarea>
              <div id="parseconf_feedback" class="feedback">
              </div>
            </fieldset>
          </td>
        </tr>
        <tr>
          <td width="50%" valign="top">
            <fieldset>
              <legend>Scanner output</legend>
              <div id="scan_feedback" class="feedback">
              </div>
            </fieldset>
<          </td>
          <td width="50%" valign="top">
            <fieldset>
              <legend>Parser output</legend>
              <div id="parse_feedback" class="feedback">
              </div>
            </fieldset>
          </td>
        </tr>
<!--        <tr>
          <td colspan="2">
            <textarea name="console" cols="100" rows="10">
            </textarea>
          </td>
        </tr> -->
      </table>
      <fieldset>
        <legend>Actions</legend>
        <input type="button" value="Click"/>
        <input type="submit"/>
      </fieldset>
    </form>
    
  </body>
</html>
