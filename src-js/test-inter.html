<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
    <script type="text/javascript" src="p2x.js"></script>
    <script type="text/javascript">
      function parseJSON(text) {
        console.log(text)
        result = eval('var XXX = ' + text)
        return XXX;
      }
      function runP2X() {
        var scanConf_JSON = document.forms.p2x.scanconf.value
        var scanConf = parseJSON(scanConf_JSON)
        var scanner = P2X.JScanner()
        scanner.set(scanConf.rules)

        var fb = document.getElementById('scanconf_feedback')
        fb.innerHTML = '<kbd>' + scanner.get().toSource() + '</kbd>'
        
        var parseConf_JSON = document.forms.p2x.parseconf.value
        var parseConf = parseJSON(parseConf_JSON)
        var parser = P2X.Parser()
        parser.setconfig(parseConf)

        var fb = document.getElementById('parseconf_feedback')
        var pcrw = P2X.ParserConfigRW()
        fb.innerHTML = '<pre>' + pcrw.asJSON(parser.getconfig()) + '</pre>'
        
        var input = document.forms.p2x.input.value
        scanner.str(input)
        var tl = scanner.lexall()

        var fb = document.getElementById('scan_feedback')
        tl.scanner = null
        fb.innerHTML = '<textarea readonly="readonly" class="xml output">' + tl.asxml() + '</textarea>'
        fb.children[0].scrollTop = fb.children[0].scrollHeight
        
        var res = parser.parse(tl)

        tpOptions = P2X.TreePrinterOptions();
        var tp = P2X.TreePrinter(parser.tokenInfo, tpOptions)
        document.forms.p2x.output.value = tp.asxml(parser.root)
     }
    </script>
    <style type="text/css">
      .output {
        font-size: 80%;
        font-weight: 300;
      }
      textarea {
        width: 100%;
        height: 20em;
      }
    </style>
    <title>Scanner test page</title>
  </head>
  <body onload="runP2X();">
    <h1>TEST</h1>

    <form name="p2x" action="javascript: runP2X()">
      <table width="100%">
        <tr>
          <td width="50%" valign="top">
            <fieldset>
              <legend>Transform input</legend>
              <textarea name="input" cols="50" rows="10">
-x + 456 + 123 = 233
              </textarea>
            </fieldset>
          </td>
          <td width="50%" valign="top">
            <fieldset>
              <legend>Transform output</legend>
              <textarea name="output" cols="50" rows="10">
              </textarea>
            </fieldset>
          </td>
        </tr>
        <tr>
          <td width="50%" valign="top">
            <fieldset>
              <legend>Scanner settings</legend>
              <textarea name="scanconf" cols="50" rows="10">
{
name: 'Test',
rules: [
  { re: '[0-9]+', action: TOKEN_INTEGER },
  { re: '[a-zA-Z_][a-zA-Z0-9_]*', action: TOKEN_IDENTIFIER },
  { re: '=', action: TOKEN_EQUAL },
  { re: '\\+', action: TOKEN_PLUS },
  { re: '-', action: TOKEN_MINUS },
  { re: '\\*', action: TOKEN_MULT },
  { re: '/', action: TOKEN_DIV },
  { re: '%', action: TOKEN_MOD },
  { re: '\\^', action: TOKEN_POW },
]
}
              </textarea>
              <div id="scanconf_feedback" class="feedback">
              </div>
            </fieldset>
          </td>
          <td width="50%" valign="top">
            <fieldset>
              <legend>Parser settings</legend>
              <textarea name="parseconf" cols="50" rows="10">
{
 rules: [                
  { token: TOKEN_L_PAREN, mode: MODE_POSTFIX, isParen: 1,
    closingList: [
     { token: TOKEN_R_PAREN }
    ]
  },
  { token: TOKEN_EQUAL, mode: MODE_BINARY, assoc: ASSOC_RIGHT, prec: 500 },
  { token: TOKEN_PLUS, mode: MODE_UNARY_BINARY, assoc: ASSOC_LEFT, prec: 1000, precU: 2200 },
  { token: TOKEN_MINUS, mode: MODE_UNARY_BINARY, assoc: ASSOC_LEFT, prec: 1000, precU: 2200 },
  { token: TOKEN_MULT, mode: MODE_BINARY, assoc: ASSOC_LEFT, prec: 1100 },
  { token: TOKEN_DIV, mode: MODE_BINARY, assoc: ASSOC_LEFT, prec: 1200 },
  { token: TOKEN_MOD, mode: MODE_BINARY, assoc: ASSOC_LEFT, prec: 1300 },
  { token: TOKEN_POW, mode: MODE_BINARY, assoc: ASSOC_LEFT, prec: 1400 },
 ]
}
              </textarea>
              <div id="parseconf_feedback" class="feedback">
              </div>
            </fieldset>
          </td>
        </tr>
        <tr>
          <td width="50%" valign="top">
            <fieldset>
              <legend>Scanner output</legend>
              <div id="scan_feedback" class="feedback">
              </div>
            </fieldset>
<          </td>
          <td width="50%" valign="top">
            <fieldset>
              <legend>Parser output</legend>
              <div id="parse_feedback" class="feedback">
              </div>
            </fieldset>
          </td>
        </tr>
<!--        <tr>
          <td colspan="2">
            <textarea name="console" cols="100" rows="10">
            </textarea>
          </td>
        </tr> -->
      </table>
      <fieldset>
        <legend>Actions</legend>
        <input type="button" value="Click"/>
        <input type="submit"/>
      </fieldset>
    </form>
    
  </body>
</html>
